<div class="container py-4">
  @if (isLoading) {
    <div class="text-center">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
    </div>
  } @else if (user) {
    <div class="row">
      <!-- Profile Header -->
      <div class="col-12 mb-4">
        <div class="card">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-start">
              <div class="d-flex align-items-center">
                <div class="profile-avatar bg-primary text-white rounded-circle d-flex align-items-center justify-content-center me-3">
                  {{ user.firstName.charAt(0) }}{{ user.lastName.charAt(0) }}
                </div>
                <div>
                  <h3 class="mb-0">{{ user.firstName }} {{ user.lastName }}</h3>
                  <p class="text-muted mb-0">{{ user.email }}</p>
                </div>
              </div>
              <button class="btn btn-outline-primary" (click)="toggleEdit()">
                @if (isEditing) {
                  <i class="bi bi-x"></i> Cancel
                } @else {
                  <i class="bi bi-pencil"></i> Edit Profile
                }
              </button>
            </div>

            <!-- Stats -->
            <div class="row mt-4 text-center">
              <div class="col-4">
                <h4 class="mb-0">{{ user.placesCount || 0 }}</h4>
                <small class="text-muted">Places</small>
              </div>
              <div class="col-4">
                <a routerLink="/profile/followers" class="text-decoration-none">
                  <h4 class="mb-0">{{ followersCount }}</h4>
                  <small class="text-muted">Followers</small>
                </a>
              </div>
              <div class="col-4">
                <a routerLink="/profile/following" class="text-decoration-none">
                  <h4 class="mb-0">{{ followingCount }}</h4>
                  <small class="text-muted">Following</small>
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Messages -->
      @if (errorMessage) {
        <div class="col-12">
          <div class="alert alert-danger" role="alert">{{ errorMessage }}</div>
        </div>
      }
      @if (successMessage) {
        <div class="col-12">
          <div class="alert alert-success" role="alert">{{ successMessage }}</div>
        </div>
      }

      <!-- Profile Form -->
      <div class="col-12">
        <div class="card">
          <div class="card-header">
            <h5 class="mb-0">Profile Information</h5>
          </div>
          <div class="card-body">
            <form [formGroup]="profileForm" (ngSubmit)="onSubmit()">
              <!-- Basic Info -->
              <h6 class="text-muted mb-3">Basic Information</h6>
              <div class="row mb-4">
                <div class="col-md-6 mb-3">
                  <label for="firstName" class="form-label">First Name</label>
                  <input type="text" class="form-control" id="firstName" formControlName="firstName" [readonly]="!isEditing" autocomplete="given-name">
                </div>
                <div class="col-md-6 mb-3">
                  <label for="lastName" class="form-label">Last Name</label>
                  <input type="text" class="form-control" id="lastName" formControlName="lastName" [readonly]="!isEditing" autocomplete="family-name">
                </div>
                <div class="col-12 mb-3">
                  <label for="bio" class="form-label">Bio</label>
                  <textarea class="form-control" id="bio" formControlName="bio" rows="3" [readonly]="!isEditing" placeholder="Tell us about yourself..."></textarea>
                </div>
              </div>

              <!-- Contact Info -->
              <h6 class="text-muted mb-3">Contact Information</h6>
              <div class="row mb-4">
                <div class="col-md-6 mb-3">
                  <label for="phone" class="form-label">Phone Number</label>
                  <input type="tel" class="form-control" id="phone" formControlName="phone" [readonly]="!isEditing" placeholder="+1234567890" autocomplete="tel">
                </div>
                <div class="col-md-6 mb-3">
                  <label for="address" class="form-label">Address</label>
                  <input type="text" class="form-control" id="address" formControlName="address" [readonly]="!isEditing" autocomplete="street-address">
                </div>
                <div class="col-md-6 mb-3">
                  <label for="city" class="form-label">City</label>
                  <input type="text" class="form-control" id="city" formControlName="city" [readonly]="!isEditing" autocomplete="address-level2">
                </div>
                <div class="col-md-6 mb-3">
                  <label for="country" class="form-label">Country</label>
                  <input type="text" class="form-control" id="country" formControlName="country" [readonly]="!isEditing" autocomplete="country-name">
                </div>
              </div>

              <!-- Location -->
              <h6 class="text-muted mb-3">Home Location</h6>
              <div class="row mb-4">
                <div class="col-md-6 mb-3">
                  <label for="homeLatitude" class="form-label">Latitude</label>
                  <input type="number" step="0.000001" class="form-control" id="homeLatitude" formControlName="homeLatitude" [readonly]="!isEditing">
                </div>
                <div class="col-md-6 mb-3">
                  <label for="homeLongitude" class="form-label">Longitude</label>
                  <input type="number" step="0.000001" class="form-control" id="homeLongitude" formControlName="homeLongitude" [readonly]="!isEditing">
                </div>
              </div>

              <!-- Social Links -->
              <h6 class="text-muted mb-3">Social Media</h6>
              <div class="row mb-4">
                <div class="col-md-6 mb-3">
                  <label for="instagram" class="form-label"><i class="bi bi-instagram"></i> Instagram</label>
                  <input type="url" class="form-control" id="instagram" formControlName="instagram" [readonly]="!isEditing" placeholder="https://instagram.com/username">
                </div>
                <div class="col-md-6 mb-3">
                  <label for="facebook" class="form-label"><i class="bi bi-facebook"></i> Facebook</label>
                  <input type="url" class="form-control" id="facebook" formControlName="facebook" [readonly]="!isEditing" placeholder="https://facebook.com/username">
                </div>
                <div class="col-md-6 mb-3">
                  <label for="linkedin" class="form-label"><i class="bi bi-linkedin"></i> LinkedIn</label>
                  <input type="url" class="form-control" id="linkedin" formControlName="linkedin" [readonly]="!isEditing" placeholder="https://linkedin.com/in/username">
                </div>
                <div class="col-md-6 mb-3">
                  <label for="tiktok" class="form-label"><i class="bi bi-tiktok"></i> TikTok</label>
                  <input type="url" class="form-control" id="tiktok" formControlName="tiktok" [readonly]="!isEditing" placeholder="https://tiktok.com/@username">
                </div>
              </div>

              @if (isEditing) {
                <div class="d-flex gap-2">
                  <button type="submit" class="btn btn-primary" [disabled]="profileForm.invalid || isSaving">
                    @if (isSaving) {
                      <span class="spinner-border spinner-border-sm me-2"></span>
                      Saving...
                    } @else {
                      <i class="bi bi-check"></i> Save Changes
                    }
                  </button>
                  <button type="button" class="btn btn-outline-secondary" (click)="toggleEdit()">
                    Cancel
                  </button>
                </div>
              }
            </form>
          </div>
        </div>
      </div>
    </div>
  }
</div>
